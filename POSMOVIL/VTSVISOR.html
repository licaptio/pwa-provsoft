<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Ventas ‚Äì Administrador</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
      getFirestore, collection, getDocs, doc, deleteDoc 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ---- CONFIG FIREBASE ----
    const firebaseConfig = {
      apiKey: "AIzaSyCK5nb6u2CGRJ8AB1aPlRn54b97bdeAFeM",
      authDomain: "inventariopv-643f1.firebaseapp.com",
      projectId: "inventariopv-643f1",
      storageBucket: "inventariopv-643f1.firebasestorage.app",
      messagingSenderId: "96242533231",
      appId: "1:96242533231:web:aae75a18fbaf9840529e9a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const rutasRef = collection(db, "rutas_venta");

    // ---- CARGAR TODAS LAS VENTAS ----
    async function cargarVentas() {
      const tabla = document.getElementById("tabla");
      tabla.innerHTML = `
        <tr>
          <th>Seleccionar</th>
          <th>ID Documento</th>
          <th>Datos</th>
        </tr>`;
      const snapshot = await getDocs(rutasRef);
      snapshot.forEach(docu => {
        const fila = document.createElement("tr");
        const datos = JSON.stringify(docu.data(), null, 2);
        fila.innerHTML = `
          <td><input type="checkbox" class="chk" value="${docu.id}"></td>
          <td>${docu.id}</td>
          <td><pre>${datos}</pre></td>
        `;
        tabla.appendChild(fila);
      });
      document.getElementById("total").innerText = snapshot.size;
    }

    // ---- ELIMINAR SELECCIONADOS ----
    async function eliminarSeleccionados() {
      const checks = document.querySelectorAll(".chk:checked");
      if (checks.length === 0) {
        alert("Selecciona al menos una venta para eliminar");
        return;
      }
      if (!confirm(`¬øEliminar ${checks.length} ventas seleccionadas?`)) return;

      for (const chk of checks) {
        const id = chk.value;
        const ref = doc(db, "rutas_venta", id);
        await deleteDoc(ref);
      }

      alert("Ventas eliminadas correctamente");
      cargarVentas();
    }

    window.eliminarSeleccionados = eliminarSeleccionados;
    window.onload = cargarVentas;
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f7fb;
      padding: 20px;
    }
    h2 {
      color: #00416A;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      vertical-align: top;
    }
    th {
      background: #00416A;
      color: white;
    }
    pre {
      font-family: monospace;
      white-space: pre-wrap;
      word-break: break-all;
    }
    button {
      background: #c62828;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 14px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover {
      background: #8e0000;
    }
  </style>
</head>
<body>
  <h2>Panel de Ventas ‚Äì Rutas Venta</h2>
  <p>Total de documentos: <span id="total">0</span></p>
  <button onclick="eliminarSeleccionados()">üóëÔ∏è Eliminar seleccionados</button>

  <table id="tabla">
    <tr><th>Seleccionar</th><th>ID Documento</th><th>Datos</th></tr>
  </table>
</body>
</html>
